
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>go-vcard: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">github.com/rumendamyanov/go-vcard/methods.go (98.5%)</option>
				
				<option value="file1">github.com/rumendamyanov/go-vcard/types.go (100.0%)</option>
				
				<option value="file2">github.com/rumendamyanov/go-vcard/utils.go (87.2%)</option>
				
				<option value="file3">github.com/rumendamyanov/go-vcard/vcard.go (89.2%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">no coverage</span>
				<span class="cov1">low coverage</span>
				<span class="cov2">*</span>
				<span class="cov3">*</span>
				<span class="cov4">*</span>
				<span class="cov5">*</span>
				<span class="cov6">*</span>
				<span class="cov7">*</span>
				<span class="cov8">*</span>
				<span class="cov9">*</span>
				<span class="cov10">high coverage</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package vcard

import (
        "encoding/base64"
        "fmt"
        "os"
        "time"
)

// AddName sets the contact's name
func (v *VCard) AddName(first, last string) *VCard <span class="cov10" title="37">{
        v.name.First = first
        v.name.Last = last
        return v
}</span>

// AddMiddleName sets the middle name
func (v *VCard) AddMiddleName(middle string) *VCard <span class="cov2" title="2">{
        v.name.Middle = middle
        return v
}</span>

// AddPrefix sets the name prefix (Mr., Dr., etc.)
func (v *VCard) AddPrefix(prefix string) *VCard <span class="cov2" title="2">{
        v.name.Prefix = prefix
        return v
}</span>

// AddSuffix sets the name suffix (Jr., PhD, etc.)
func (v *VCard) AddSuffix(suffix string) *VCard <span class="cov2" title="2">{
        v.name.Suffix = suffix
        return v
}</span>

// SetName sets the complete name structure
func (v *VCard) SetName(name Name) *VCard <span class="cov4" title="4">{
        v.name = name
        return v
}</span>

// AddEmail adds an email address with optional type
func (v *VCard) AddEmail(address string, emailType ...EmailType) *VCard <span class="cov7" title="13">{
        email := Email{
                Address: address,
        }

        if len(emailType) &gt; 0 </span><span class="cov5" title="6">{
                email.Type = emailType[0]
        }</span> else<span class="cov5" title="7"> {
                email.Type = EmailInternet
        }</span>

        <span class="cov7" title="13">v.emails = append(v.emails, email)
        return v</span>
}

// AddEmailWithPreference adds an email address with type and preference
func (v *VCard) AddEmailWithPreference(address string, emailType EmailType, preferred bool) *VCard <span class="cov3" title="3">{
        email := Email{
                Address:   address,
                Type:      emailType,
                Preferred: preferred,
        }

        v.emails = append(v.emails, email)
        return v
}</span>

// AddEmails adds multiple email addresses at once
func (v *VCard) AddEmails(emails []Email) *VCard <span class="cov5" title="5">{
        v.emails = append(v.emails, emails...)
        return v
}</span>

// AddPhone adds a phone number with optional type
func (v *VCard) AddPhone(number string, phoneType ...PhoneType) *VCard <span class="cov6" title="9">{
        phone := Phone{
                Number: number,
        }

        if len(phoneType) &gt; 0 </span><span class="cov5" title="6">{
                phone.Type = phoneType[0]
        }</span> else<span class="cov3" title="3"> {
                phone.Type = PhoneVoice
        }</span>

        <span class="cov6" title="9">v.phones = append(v.phones, phone)
        return v</span>
}

// AddPhoneWithPreference adds a phone number with type and preference
func (v *VCard) AddPhoneWithPreference(number string, phoneType PhoneType, preferred bool) *VCard <span class="cov3" title="3">{
        phone := Phone{
                Number:    number,
                Type:      phoneType,
                Preferred: preferred,
        }

        v.phones = append(v.phones, phone)
        return v
}</span>

// AddPhones adds multiple phone numbers at once
func (v *VCard) AddPhones(phones []Phone) *VCard <span class="cov5" title="5">{
        v.phones = append(v.phones, phones...)
        return v
}</span>

// AddAddress adds an address with optional type
func (v *VCard) AddAddress(street, city, state, postalCode, country string, addressType ...AddressType) *VCard <span class="cov5" title="5">{
        address := Address{
                Street:     street,
                City:       city,
                State:      state,
                PostalCode: postalCode,
                Country:    country,
        }

        if len(addressType) &gt; 0 </span><span class="cov4" title="4">{
                address.Type = addressType[0]
        }</span>

        <span class="cov5" title="5">v.addresses = append(v.addresses, address)
        return v</span>
}

// AddAddressExtended adds an address with extended information
func (v *VCard) AddAddressExtended(street, extended, city, state, postalCode, country string, addressType ...AddressType) *VCard <span class="cov3" title="3">{
        address := Address{
                Street:     street,
                Extended:   extended,
                City:       city,
                State:      state,
                PostalCode: postalCode,
                Country:    country,
        }

        if len(addressType) &gt; 0 </span><span class="cov3" title="3">{
                address.Type = addressType[0]
        }</span>

        <span class="cov3" title="3">v.addresses = append(v.addresses, address)
        return v</span>
}

// AddAddressWithPreference adds an address with type and preference
func (v *VCard) AddAddressWithPreference(street, city, state, postalCode, country string, addressType AddressType, preferred bool) *VCard <span class="cov3" title="3">{
        address := Address{
                Street:     street,
                City:       city,
                State:      state,
                PostalCode: postalCode,
                Country:    country,
                Type:       addressType,
                Preferred:  preferred,
        }

        v.addresses = append(v.addresses, address)
        return v
}</span>

// AddAddresses adds multiple addresses at once
func (v *VCard) AddAddresses(addresses []Address) *VCard <span class="cov4" title="4">{
        v.addresses = append(v.addresses, addresses...)
        return v
}</span>

// AddOrganization sets the organization name
func (v *VCard) AddOrganization(name string) *VCard <span class="cov3" title="3">{
        v.organization.Name = name
        return v
}</span>

// AddDepartment sets the department
func (v *VCard) AddDepartment(department string) *VCard <span class="cov3" title="3">{
        v.organization.Department = department
        return v
}</span>

// AddTitle sets the job title
func (v *VCard) AddTitle(title string) *VCard <span class="cov2" title="2">{
        v.organization.Title = title
        return v
}</span>

// AddRole sets the role/position
func (v *VCard) AddRole(role string) *VCard <span class="cov3" title="3">{
        v.organization.Role = role
        return v
}</span>

// SetOrganization sets the complete organization structure
func (v *VCard) SetOrganization(org Organization) *VCard <span class="cov4" title="4">{
        v.organization = org
        return v
}</span>

// AddURL adds a URL with optional type
func (v *VCard) AddURL(address string, urlType ...URLType) *VCard <span class="cov5" title="6">{
        url := URL{
                Address: address,
        }

        if len(urlType) &gt; 0 </span><span class="cov5" title="5">{
                url.Type = urlType[0]
        }</span>

        <span class="cov5" title="6">v.urls = append(v.urls, url)
        return v</span>
}

// AddURLWithPreference adds a URL with type and preference
func (v *VCard) AddURLWithPreference(address string, urlType URLType, preferred bool) *VCard <span class="cov3" title="3">{
        url := URL{
                Address:   address,
                Type:      urlType,
                Preferred: preferred,
        }

        v.urls = append(v.urls, url)
        return v
}</span>

// AddURLs adds multiple URLs at once
func (v *VCard) AddURLs(urls []URL) *VCard <span class="cov4" title="4">{
        v.urls = append(v.urls, urls...)
        return v
}</span>

// AddPhoto sets the photo (URL or base64 data)
func (v *VCard) AddPhoto(photo string) *VCard <span class="cov5" title="6">{
        v.photo = photo
        return v
}</span>

// AddPhotoFromFile loads a photo from file and encodes as base64
func (v *VCard) AddPhotoFromFile(filename string) error <span class="cov3" title="3">{
        data, err := os.ReadFile(filename)
        if err != nil </span><span class="cov2" title="2">{
                return err
        }</span>
        
        // Encode as base64 data URI
        <span class="cov1" title="1">encoded := base64.StdEncoding.EncodeToString(data)
        v.photo = "data:image/jpeg;base64," + encoded
        return nil</span>
}

// AddNote sets a note
func (v *VCard) AddNote(note string) *VCard <span class="cov4" title="4">{
        v.note = note
        return v
}</span>

// AddBirthday sets the birthday
func (v *VCard) AddBirthday(birthday time.Time) *VCard <span class="cov2" title="2">{
        v.birthday = &amp;birthday
        return v
}</span>

// AddBirthdayFromString sets the birthday from a date string (YYYY-MM-DD)
func (v *VCard) AddBirthdayFromString(dateStr string) error <span class="cov5" title="5">{
        birthday, err := time.Parse("2006-01-02", dateStr)
        if err != nil </span><span class="cov1" title="1">{
                return fmt.Errorf("invalid date format: %w", err)
        }</span>
        <span class="cov4" title="4">v.birthday = &amp;birthday
        return nil</span>
}

// AddAnniversary sets the anniversary (vCard 4.0 only)
func (v *VCard) AddAnniversary(anniversary time.Time) *VCard <span class="cov2" title="2">{
        v.anniversary = &amp;anniversary
        return v
}</span>

// AddAnniversaryFromString sets the anniversary from a date string (YYYY-MM-DD)
func (v *VCard) AddAnniversaryFromString(dateStr string) error <span class="cov5" title="5">{
        anniversary, err := time.Parse("2006-01-02", dateStr)
        if err != nil </span><span class="cov1" title="1">{
                return fmt.Errorf("invalid date format: %w", err)
        }</span>
        <span class="cov4" title="4">v.anniversary = &amp;anniversary
        return nil</span>
}

// AddCustomProperty adds a custom X- property
func (v *VCard) AddCustomProperty(name, value string) *VCard <span class="cov5" title="7">{
        if v.customProps == nil </span><span class="cov0" title="0">{
                v.customProps = make(map[string]string)
        }</span>
        <span class="cov5" title="7">v.customProps[name] = value
        return v</span>
}

// AddCustomProperties adds multiple custom properties at once
func (v *VCard) AddCustomProperties(props map[string]string) *VCard <span class="cov4" title="4">{
        if v.customProps == nil </span><span class="cov0" title="0">{
                v.customProps = make(map[string]string)
        }</span>

        <span class="cov4" title="4">for k, val := range props </span><span class="cov5" title="7">{
                v.customProps[k] = val
        }</span>

        <span class="cov4" title="4">return v</span>
}

// AddContact adds contact information from a Contact structure
func (v *VCard) AddContact(contact Contact) *VCard <span class="cov2" title="2">{
        // Set name
        v.SetName(contact.Name)

        // Add emails
        if len(contact.Emails) &gt; 0 </span><span class="cov2" title="2">{
                v.AddEmails(contact.Emails)
        }</span>

        // Add phones
        <span class="cov2" title="2">if len(contact.Phones) &gt; 0 </span><span class="cov2" title="2">{
                v.AddPhones(contact.Phones)
        }</span>

        // Add addresses
        <span class="cov2" title="2">if len(contact.Addresses) &gt; 0 </span><span class="cov1" title="1">{
                v.AddAddresses(contact.Addresses)
        }</span>

        // Set organization
        <span class="cov2" title="2">if contact.Organization.Name != "" </span><span class="cov2" title="2">{
                v.SetOrganization(contact.Organization)
        }</span>

        // Add URLs
        <span class="cov2" title="2">if len(contact.URLs) &gt; 0 </span><span class="cov1" title="1">{
                v.AddURLs(contact.URLs)
        }</span>

        // Set photo
        <span class="cov2" title="2">if contact.Photo != "" </span><span class="cov1" title="1">{
                v.AddPhoto(contact.Photo)
        }</span>

        // Set note
        <span class="cov2" title="2">if contact.Note != "" </span><span class="cov1" title="1">{
                v.AddNote(contact.Note)
        }</span>

        // Set birthday
        <span class="cov2" title="2">if contact.Birthday != nil </span><span class="cov1" title="1">{
                if err := v.AddBirthdayFromString(*contact.Birthday); err == nil </span>{<span class="cov1" title="1">
                        // Birthday set successfully
                }</span>
        }

        // Set anniversary
        <span class="cov2" title="2">if contact.Anniversary != nil </span><span class="cov1" title="1">{
                if err := v.AddAnniversaryFromString(*contact.Anniversary); err == nil </span>{<span class="cov1" title="1">
                        // Anniversary set successfully
                }</span>
        }

        // Add custom properties
        <span class="cov2" title="2">if len(contact.CustomProps) &gt; 0 </span><span class="cov1" title="1">{
                v.AddCustomProperties(contact.CustomProps)
        }</span>

        <span class="cov2" title="2">return v</span>
}

// GetEmail returns the first email address (if any)
func (v *VCard) GetEmail() string <span class="cov5" title="6">{
        if len(v.emails) &gt; 0 </span><span class="cov4" title="4">{
                return v.emails[0].Address
        }</span>
        <span class="cov2" title="2">return ""</span>
}

// GetPhone returns the first phone number (if any)
func (v *VCard) GetPhone() string <span class="cov5" title="5">{
        if len(v.phones) &gt; 0 </span><span class="cov4" title="4">{
                return v.phones[0].Number
        }</span>
        <span class="cov1" title="1">return ""</span>
}

// GetAddress returns the first address (if any)
func (v *VCard) GetAddress() *Address <span class="cov4" title="4">{
        if len(v.addresses) &gt; 0 </span><span class="cov3" title="3">{
                return &amp;v.addresses[0]
        }</span>
        <span class="cov1" title="1">return nil</span>
}

// GetURL returns the first URL (if any)
func (v *VCard) GetURL() string <span class="cov4" title="4">{
        if len(v.urls) &gt; 0 </span><span class="cov3" title="3">{
                return v.urls[0].Address
        }</span>
        <span class="cov1" title="1">return ""</span>
}
</pre>
		
		<pre class="file" id="file1" style="display: none">package vcard

import (
        "strings"
)

// EmailType represents the type of email address
type EmailType string

const (
        // EmailInternet represents an internet email address (default)
        EmailInternet EmailType = "INTERNET"

        // EmailWork represents a work email address
        EmailWork EmailType = "WORK"

        // EmailHome represents a home email address
        EmailHome EmailType = "HOME"

        // EmailMobile represents a mobile email address
        EmailMobile EmailType = "MOBILE"
)

// PhoneType represents the type of phone number
type PhoneType string

const (
        // PhoneVoice represents a voice phone number (default)
        PhoneVoice PhoneType = "VOICE"

        // PhoneWork represents a work phone number
        PhoneWork PhoneType = "WORK"

        // PhoneHome represents a home phone number
        PhoneHome PhoneType = "HOME"

        // PhoneMobile represents a mobile phone number
        PhoneMobile PhoneType = "MOBILE"

        // PhoneFax represents a fax number
        PhoneFax PhoneType = "FAX"
)

// AddressType represents the type of address
type AddressType string

const (
        // AddressWork represents a work address
        AddressWork AddressType = "WORK"

        // AddressHome represents a home address
        AddressHome AddressType = "HOME"

        // AddressPostal represents a postal address
        AddressPostal AddressType = "POSTAL"
)

// URLType represents the type of URL
type URLType string

const (
        // URLWork represents a work-related URL
        URLWork URLType = "WORK"

        // URLHome represents a personal URL
        URLHome URLType = "HOME"

        // URLSocial represents a social media URL
        URLSocial URLType = "SOCIAL"
)

// Name represents the structured name information
type Name struct {
        // Last name (family name)
        Last string

        // First name (given name)
        First string

        // Middle name(s) (additional names)
        Middle string

        // Name prefix (Mr., Dr., etc.)
        Prefix string

        // Name suffix (Jr., PhD, etc.)
        Suffix string
}

// FormattedName returns the full formatted name
func (n Name) FormattedName() string <span class="cov10" title="34">{
        var parts []string

        if n.Prefix != "" </span><span class="cov2" title="2">{
                parts = append(parts, n.Prefix)
        }</span>

        <span class="cov10" title="34">if n.First != "" </span><span class="cov9" title="33">{
                parts = append(parts, n.First)
        }</span>

        <span class="cov10" title="34">if n.Middle != "" </span><span class="cov3" title="3">{
                parts = append(parts, n.Middle)
        }</span>

        <span class="cov10" title="34">if n.Last != "" </span><span class="cov9" title="33">{
                parts = append(parts, n.Last)
        }</span>

        <span class="cov10" title="34">if n.Suffix != "" </span><span class="cov2" title="2">{
                parts = append(parts, n.Suffix)
        }</span>

        <span class="cov10" title="34">return strings.Join(parts, " ")</span>
}

// StructuredName returns the vCard structured name format (N property)
func (n Name) StructuredName() string <span class="cov8" title="21">{
        return strings.Join([]string{
                escapeValue(n.Last),
                escapeValue(n.First),
                escapeValue(n.Middle),
                escapeValue(n.Prefix),
                escapeValue(n.Suffix),
        }, ";")
}</span>

// Email represents an email address with optional type
type Email struct {
        // The email address
        Address string

        // The type of email (optional)
        Type EmailType

        // Whether this is the preferred email
        Preferred bool
}

// Phone represents a phone number with optional type
type Phone struct {
        // The phone number
        Number string

        // The type of phone (optional)
        Type PhoneType

        // Whether this is the preferred phone
        Preferred bool
}

// Address represents a postal address
type Address struct {
        // Street address
        Street string

        // Extended address (apartment, suite, etc.)
        Extended string

        // City/locality
        City string

        // State/region/province
        State string

        // Postal code
        PostalCode string

        // Country
        Country string

        // Address type (optional)
        Type AddressType

        // Whether this is the preferred address
        Preferred bool
}

// StructuredAddress returns the vCard structured address format (ADR property)
func (a Address) StructuredAddress() string <span class="cov6" title="8">{
        return strings.Join([]string{
                "",                        // Post office box (not commonly used)
                escapeValue(a.Extended),   // Extended address
                escapeValue(a.Street),     // Street address
                escapeValue(a.City),       // Locality
                escapeValue(a.State),      // Region
                escapeValue(a.PostalCode), // Postal code
                escapeValue(a.Country),    // Country
        }, ";")
}</span>

// FormattedAddress returns a human-readable address string
func (a Address) FormattedAddress() string <span class="cov6" title="8">{
        var parts []string

        if a.Street != "" </span><span class="cov6" title="8">{
                parts = append(parts, a.Street)
        }</span>

        <span class="cov6" title="8">if a.Extended != "" </span><span class="cov2" title="2">{
                parts = append(parts, a.Extended)
        }</span>

        <span class="cov6" title="8">var cityState []string
        if a.City != "" </span><span class="cov6" title="8">{
                cityState = append(cityState, a.City)
        }</span>
        <span class="cov6" title="8">if a.State != "" </span><span class="cov5" title="6">{
                cityState = append(cityState, a.State)
        }</span>
        <span class="cov6" title="8">if len(cityState) &gt; 0 </span><span class="cov6" title="8">{
                parts = append(parts, strings.Join(cityState, ", "))
        }</span>

        <span class="cov6" title="8">if a.PostalCode != "" </span><span class="cov5" title="6">{
                parts = append(parts, a.PostalCode)
        }</span>

        <span class="cov6" title="8">if a.Country != "" </span><span class="cov5" title="6">{
                parts = append(parts, a.Country)
        }</span>

        <span class="cov6" title="8">return strings.Join(parts, "\n")</span>
}

// Organization represents organization/work information
type Organization struct {
        // Organization name
        Name string

        // Department
        Department string

        // Job title
        Title string

        // Role/position
        Role string
}

// URL represents a website or URL with optional type
type URL struct {
        // The URL
        Address string

        // The type of URL (optional)
        Type URLType

        // Whether this is the preferred URL
        Preferred bool
}

// Contact represents a complete contact structure for batch operations
type Contact struct {
        Name         Name
        Emails       []Email
        Phones       []Phone
        Addresses    []Address
        Organization Organization
        URLs         []URL
        Photo        string
        Note         string
        Birthday     *string // Date string in YYYY-MM-DD format
        Anniversary  *string // Date string in YYYY-MM-DD format
        CustomProps  map[string]string
}
</pre>
		
		<pre class="file" id="file2" style="display: none">package vcard

import (
        "fmt"
        "strings"
)

// escapeValue escapes special characters in vCard property values
func escapeValue(value string) string <span class="cov10" title="226">{
        // Replace special characters according to vCard specification
        value = strings.ReplaceAll(value, "\\", "\\\\")
        value = strings.ReplaceAll(value, ",", "\\,")
        value = strings.ReplaceAll(value, ";", "\\;")
        value = strings.ReplaceAll(value, "\n", "\\n")
        value = strings.ReplaceAll(value, "\r", "\\r")
        return value
}</span>

// unescapeValue unescapes special characters in vCard property values
func unescapeValue(value string) string <span class="cov3" title="6">{
        value = strings.ReplaceAll(value, "\\\\", "\\")
        value = strings.ReplaceAll(value, "\\,", ",")
        value = strings.ReplaceAll(value, "\\;", ";")
        value = strings.ReplaceAll(value, "\\n", "\n")
        value = strings.ReplaceAll(value, "\\r", "\r")
        value = strings.ReplaceAll(value, "\\t", "\t")
        return value
}</span>

// foldLine folds long lines according to vCard specification (75 characters)
func foldLine(line string) string <span class="cov7" title="59">{
        if len(line) &lt;= 75 </span><span class="cov7" title="57">{
                return line
        }</span>

        <span class="cov2" title="2">var result strings.Builder
        for i, r := range line </span><span class="cov9" title="200">{
                if i &gt; 0 &amp;&amp; i%75 == 0 </span><span class="cov2" title="2">{
                        result.WriteString("\r\n ")
                }</span>
                <span class="cov9" title="200">result.WriteRune(r)</span>
        }

        <span class="cov2" title="2">return result.String()</span>
}

// formatTypeParameter formats type parameters for vCard properties
func formatTypeParameter(types ...string) string <span class="cov6" title="34">{
        if len(types) == 0 </span><span class="cov0" title="0">{
                return ""
        }</span>

        <span class="cov6" title="34">var validTypes []string
        for _, t := range types </span><span class="cov6" title="34">{
                if t != "" </span><span class="cov6" title="34">{
                        validTypes = append(validTypes, t)
                }</span>
        }

        <span class="cov6" title="34">if len(validTypes) == 0 </span><span class="cov0" title="0">{
                return ""
        }</span>

        <span class="cov6" title="34">return ";TYPE=" + strings.Join(validTypes, ",")</span>
}

// writeNameProperties writes name-related properties to the builder
func (v *VCard) writeNameProperties(builder *strings.Builder) error <span class="cov6" title="21">{
        // Write structured name (N property) - required
        builder.WriteString(fmt.Sprintf("N:%s\n", v.name.StructuredName()))

        // Write formatted name (FN property) - required
        formattedName := v.name.FormattedName()
        if formattedName == "" </span><span class="cov0" title="0">{
                // If no formatted name, use "Last, First" or just "First" or "Last"
                if v.name.Last != "" &amp;&amp; v.name.First != "" </span><span class="cov0" title="0">{
                        formattedName = v.name.Last + ", " + v.name.First
                }</span> else<span class="cov0" title="0"> if v.name.First != "" </span><span class="cov0" title="0">{
                        formattedName = v.name.First
                }</span> else<span class="cov0" title="0"> if v.name.Last != "" </span><span class="cov0" title="0">{
                        formattedName = v.name.Last
                }</span>
        }

        <span class="cov6" title="21">if formattedName != "" </span><span class="cov6" title="21">{
                builder.WriteString(fmt.Sprintf("FN:%s\n", escapeValue(formattedName)))
        }</span>

        <span class="cov6" title="21">return nil</span>
}

// writeEmailProperties writes email properties to the builder
func (v *VCard) writeEmailProperties(builder *strings.Builder) <span class="cov6" title="21">{
        for _, email := range v.emails </span><span class="cov4" title="11">{
                var typeParam string
                if email.Type != "" </span><span class="cov4" title="11">{
                        typeParam = formatTypeParameter(string(email.Type))
                }</span> else<span class="cov0" title="0"> {
                        typeParam = formatTypeParameter("INTERNET")
                }</span>

                <span class="cov4" title="11">if email.Preferred </span><span class="cov2" title="2">{
                        typeParam += ";PREF=1"
                }</span>

                <span class="cov4" title="11">line := fmt.Sprintf("EMAIL%s:%s", typeParam, escapeValue(email.Address))
                builder.WriteString(foldLine(line) + "\n")</span>
        }
}

// writePhoneProperties writes phone properties to the builder
func (v *VCard) writePhoneProperties(builder *strings.Builder) <span class="cov6" title="21">{
        for _, phone := range v.phones </span><span class="cov4" title="9">{
                var typeParam string
                if phone.Type != "" </span><span class="cov4" title="9">{
                        typeParam = formatTypeParameter(string(phone.Type))
                }</span> else<span class="cov0" title="0"> {
                        typeParam = formatTypeParameter("VOICE")
                }</span>

                <span class="cov4" title="9">if phone.Preferred </span><span class="cov2" title="2">{
                        typeParam += ";PREF=1"
                }</span>

                <span class="cov4" title="9">line := fmt.Sprintf("TEL%s:%s", typeParam, escapeValue(phone.Number))
                builder.WriteString(foldLine(line) + "\n")</span>
        }
}

// writeAddressProperties writes address properties to the builder
func (v *VCard) writeAddressProperties(builder *strings.Builder) <span class="cov6" title="21">{
        for _, addr := range v.addresses </span><span class="cov4" title="8">{
                var typeParam string
                if addr.Type != "" </span><span class="cov4" title="8">{
                        typeParam = formatTypeParameter(string(addr.Type))
                }</span>

                <span class="cov4" title="8">if addr.Preferred </span><span class="cov2" title="2">{
                        typeParam += ";PREF=1"
                }</span>

                <span class="cov4" title="8">line := fmt.Sprintf("ADR%s:%s", typeParam, addr.StructuredAddress())
                builder.WriteString(foldLine(line) + "\n")

                // Also write formatted address label if we have address data
                if addr.Street != "" || addr.City != "" || addr.State != "" || addr.PostalCode != "" || addr.Country != "" </span><span class="cov4" title="8">{
                        labelLine := fmt.Sprintf("LABEL%s:%s", typeParam, escapeValue(addr.FormattedAddress()))
                        builder.WriteString(foldLine(labelLine) + "\n")
                }</span>
        }
}

// writeOrganizationProperties writes organization properties to the builder
func (v *VCard) writeOrganizationProperties(builder *strings.Builder) <span class="cov6" title="21">{
        if v.organization.Name != "" </span><span class="cov2" title="2">{
                var orgParts []string
                orgParts = append(orgParts, escapeValue(v.organization.Name))
                if v.organization.Department != "" </span><span class="cov2" title="2">{
                        orgParts = append(orgParts, escapeValue(v.organization.Department))
                }</span>

                <span class="cov2" title="2">line := fmt.Sprintf("ORG:%s", strings.Join(orgParts, ";"))
                builder.WriteString(foldLine(line) + "\n")</span>
        }

        <span class="cov6" title="21">if v.organization.Title != "" </span><span class="cov2" title="2">{
                line := fmt.Sprintf("TITLE:%s", escapeValue(v.organization.Title))
                builder.WriteString(foldLine(line) + "\n")
        }</span>

        <span class="cov6" title="21">if v.organization.Role != "" </span><span class="cov2" title="2">{
                line := fmt.Sprintf("ROLE:%s", escapeValue(v.organization.Role))
                builder.WriteString(foldLine(line) + "\n")
        }</span>
}

// writeURLProperties writes URL properties to the builder
func (v *VCard) writeURLProperties(builder *strings.Builder) <span class="cov6" title="21">{
        for _, url := range v.urls </span><span class="cov3" title="6">{
                var typeParam string
                if url.Type != "" </span><span class="cov3" title="6">{
                        typeParam = formatTypeParameter(string(url.Type))
                }</span>

                <span class="cov3" title="6">if url.Preferred </span><span class="cov2" title="2">{
                        typeParam += ";PREF=1"
                }</span>

                <span class="cov3" title="6">line := fmt.Sprintf("URL%s:%s", typeParam, escapeValue(url.Address))
                builder.WriteString(foldLine(line) + "\n")</span>
        }
}

// writePhotoProperty writes photo property to the builder
func (v *VCard) writePhotoProperty(builder *strings.Builder) <span class="cov2" title="3">{
        if v.photo == "" </span><span class="cov0" title="0">{
                return
        }</span>

        // Check if it's a URL or base64 data
        <span class="cov2" title="3">if strings.HasPrefix(v.photo, "http://") || strings.HasPrefix(v.photo, "https://") </span><span class="cov2" title="2">{
                // External URL
                line := fmt.Sprintf("PHOTO;VALUE=uri:%s", v.photo)
                builder.WriteString(foldLine(line) + "\n")
        }</span> else<span class="cov1" title="1"> if strings.HasPrefix(v.photo, "data:") </span><span class="cov1" title="1">{
                // Data URI (base64 encoded)
                line := fmt.Sprintf("PHOTO;ENCODING=b:%s", v.photo)
                builder.WriteString(foldLine(line) + "\n")
        }</span> else<span class="cov0" title="0"> {
                // Assume it's base64 data without data URI prefix
                line := fmt.Sprintf("PHOTO;ENCODING=b;TYPE=JPEG:%s", v.photo)
                builder.WriteString(foldLine(line) + "\n")
        }</span>
}

// writeBirthdayProperty writes birthday property to the builder
func (v *VCard) writeBirthdayProperty(builder *strings.Builder) <span class="cov2" title="2">{
        if v.birthday == nil </span><span class="cov0" title="0">{
                return
        }</span>

        // Format date according to vCard specification
        <span class="cov2" title="2">dateStr := v.birthday.Format("2006-01-02")
        line := fmt.Sprintf("BDAY:%s", dateStr)
        builder.WriteString(line + "\n")</span>
}

// writeAnniversaryProperty writes anniversary property to the builder
func (v *VCard) writeAnniversaryProperty(builder *strings.Builder) <span class="cov2" title="2">{
        if v.anniversary == nil </span><span class="cov0" title="0">{
                return
        }</span>

        // Anniversary is vCard 4.0 only
        <span class="cov2" title="2">if v.version == Version40 </span><span class="cov1" title="1">{
                dateStr := v.anniversary.Format("2006-01-02")
                line := fmt.Sprintf("ANNIVERSARY:%s", dateStr)
                builder.WriteString(line + "\n")
        }</span>
}

// writeCustomProperties writes custom X- properties to the builder
func (v *VCard) writeCustomProperties(builder *strings.Builder) <span class="cov6" title="21">{
        for name, value := range v.customProps </span><span class="cov3" title="4">{
                if strings.HasPrefix(strings.ToUpper(name), "X-") &amp;&amp; value != "" </span><span class="cov3" title="4">{
                        line := fmt.Sprintf("%s:%s", strings.ToUpper(name), escapeValue(value))
                        builder.WriteString(foldLine(line) + "\n")
                }</span>
        }
}
</pre>
		
		<pre class="file" id="file3" style="display: none">// Package vcard provides functionality for generating vCard files (.vcf)
// compatible with major contact managers (iOS, Android, Gmail, iCloud, etc.).
//
// This package is framework-agnostic and works seamlessly with any Go web
// framework including Gin, Echo, Fiber, Chi, and standard net/http.
//
// Basic usage:
//
//        card := vcard.New()
//        card.AddName("John", "Doe")
//        card.AddEmail("john.doe@example.com")
//        card.AddPhone("+1234567890")
//
//        content, err := card.String()
//        if err != nil {
//                // handle error
//        }
//
//        // Save to file
//        err = card.SaveToFile("contact.vcf")
//
// The package supports both vCard 3.0 and 4.0 specifications and provides
// type-safe methods for adding various contact information including names,
// emails, phones, addresses, organizations, photos, and custom properties.
package vcard

import (
        "fmt"
        "os"
        "strings"
        "time"
)

// Version represents a vCard version specification
type Version string

const (
        // Version30 represents vCard version 3.0 (RFC 2426)
        Version30 Version = "3.0"

        // Version40 represents vCard version 4.0 (RFC 6350)
        Version40 Version = "4.0"
)

// String returns the string representation of the version
func (v Version) String() string <span class="cov8" title="21">{
        return string(v)
}</span>

// VCard represents a vCard contact entry with all supported properties
type VCard struct {
        version      Version
        name         Name
        emails       []Email
        phones       []Phone
        addresses    []Address
        organization Organization
        urls         []URL
        photo        string
        note         string
        birthday     *time.Time
        anniversary  *time.Time
        customProps  map[string]string
}

// New creates a new vCard instance with default settings (version 3.0)
func New() *VCard <span class="cov10" title="44">{
        return &amp;VCard{
                version:     Version30,
                emails:      make([]Email, 0),
                phones:      make([]Phone, 0),
                addresses:   make([]Address, 0),
                urls:        make([]URL, 0),
                customProps: make(map[string]string),
        }
}</span>

// NewWithVersion creates a new vCard instance with the specified version
func NewWithVersion(version Version) *VCard <span class="cov5" title="6">{
        card := New()
        card.version = version
        return card
}</span>

// SetVersion sets the vCard version
func (v *VCard) SetVersion(version Version) *VCard <span class="cov2" title="2">{
        v.version = version
        return v
}</span>

// GetVersion returns the current vCard version
func (v *VCard) GetVersion() Version <span class="cov5" title="6">{
        return v.version
}</span>

// String generates the vCard content as a string
func (v *VCard) String() (string, error) <span class="cov8" title="21">{
        if err := v.Validate(); err != nil </span><span class="cov0" title="0">{
                return "", fmt.Errorf("vcard validation failed: %w", err)
        }</span>

        <span class="cov8" title="21">var builder strings.Builder

        // Begin vCard
        builder.WriteString("BEGIN:VCARD\n")
        builder.WriteString(fmt.Sprintf("VERSION:%s\n", v.version))

        // Add name information
        if err := v.writeNameProperties(&amp;builder); err != nil </span><span class="cov0" title="0">{
                return "", err
        }</span>

        // Add contact information
        <span class="cov8" title="21">v.writeEmailProperties(&amp;builder)
        v.writePhoneProperties(&amp;builder)
        v.writeAddressProperties(&amp;builder)
        v.writeOrganizationProperties(&amp;builder)
        v.writeURLProperties(&amp;builder)

        // Add optional properties
        if v.photo != "" </span><span class="cov3" title="3">{
                v.writePhotoProperty(&amp;builder)
        }</span>

        <span class="cov8" title="21">if v.note != "" </span><span class="cov1" title="1">{
                builder.WriteString(fmt.Sprintf("NOTE:%s\n", escapeValue(v.note)))
        }</span>

        <span class="cov8" title="21">if v.birthday != nil </span><span class="cov2" title="2">{
                v.writeBirthdayProperty(&amp;builder)
        }</span>

        <span class="cov8" title="21">if v.anniversary != nil </span><span class="cov2" title="2">{
                v.writeAnniversaryProperty(&amp;builder)
        }</span>

        // Add custom properties
        <span class="cov8" title="21">v.writeCustomProperties(&amp;builder)

        // End vCard
        builder.WriteString("END:VCARD\n")

        return builder.String(), nil</span>
}

// Bytes generates the vCard content as a byte slice
func (v *VCard) Bytes() ([]byte, error) <span class="cov3" title="3">{
        content, err := v.String()
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        <span class="cov3" title="3">return []byte(content), nil</span>
}

// SaveToFile saves the vCard content to a file
func (v *VCard) SaveToFile(filename string) error <span class="cov2" title="2">{
        content, err := v.String()
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov2" title="2">return os.WriteFile(filename, []byte(content), 0644)</span>
}

// Validate checks if the vCard has required fields and valid data
func (v *VCard) Validate() error <span class="cov8" title="28">{
        // Check if name is provided (required field)
        if v.name.First == "" &amp;&amp; v.name.Last == "" </span><span class="cov2" title="2">{
                return fmt.Errorf("vcard must have at least first name or last name")
        }</span>

        // Validate emails
        <span class="cov8" title="26">for _, email := range v.emails </span><span class="cov7" title="14">{
                if email.Address == "" </span><span class="cov0" title="0">{
                        return fmt.Errorf("email address cannot be empty")
                }</span>
        }

        // Validate phones
        <span class="cov8" title="26">for _, phone := range v.phones </span><span class="cov6" title="12">{
                if phone.Number == "" </span><span class="cov0" title="0">{
                        return fmt.Errorf("phone number cannot be empty")
                }</span>
        }

        <span class="cov8" title="26">return nil</span>
}

// IsValid returns true if the vCard has valid required fields
func (v *VCard) IsValid() bool <span class="cov3" title="3">{
        return v.Validate() == nil
}</span>

// Reset clears all vCard data, allowing reuse of the instance
func (v *VCard) Reset() *VCard <span class="cov2" title="2">{
        v.version = Version30
        v.name = Name{}
        v.emails = v.emails[:0]
        v.phones = v.phones[:0]
        v.addresses = v.addresses[:0]
        v.organization = Organization{}
        v.urls = v.urls[:0]
        v.photo = ""
        v.note = ""
        v.birthday = nil
        v.anniversary = nil

        // Clear custom properties map
        for k := range v.customProps </span><span class="cov1" title="1">{
                delete(v.customProps, k)
        }</span>

        <span class="cov2" title="2">return v</span>
}

// Clone creates a deep copy of the vCard
func (v *VCard) Clone() *VCard <span class="cov2" title="2">{
        clone := &amp;VCard{
                version:      v.version,
                name:         v.name,
                emails:       make([]Email, len(v.emails)),
                phones:       make([]Phone, len(v.phones)),
                addresses:    make([]Address, len(v.addresses)),
                organization: v.organization,
                urls:         make([]URL, len(v.urls)),
                photo:        v.photo,
                note:         v.note,
                customProps:  make(map[string]string),
        }

        // Copy slices
        copy(clone.emails, v.emails)
        copy(clone.phones, v.phones)
        copy(clone.addresses, v.addresses)
        copy(clone.urls, v.urls)

        // Copy time pointers
        if v.birthday != nil </span><span class="cov0" title="0">{
                birthday := *v.birthday
                clone.birthday = &amp;birthday
        }</span>

        <span class="cov2" title="2">if v.anniversary != nil </span><span class="cov0" title="0">{
                anniversary := *v.anniversary
                clone.anniversary = &amp;anniversary
        }</span>

        // Copy custom properties
        <span class="cov2" title="2">for k, v := range v.customProps </span><span class="cov2" title="2">{
                clone.customProps[k] = v
        }</span>

        <span class="cov2" title="2">return clone</span>
}

// GetFormattedName returns the formatted full name
func (v *VCard) GetFormattedName() string <span class="cov6" title="9">{
        return v.name.FormattedName()
}</span>

// GetName returns the name structure
func (v *VCard) GetName() Name <span class="cov2" title="2">{
        return v.name
}</span>

// GetEmails returns all email addresses
func (v *VCard) GetEmails() []Email <span class="cov4" title="4">{
        return v.emails
}</span>

// GetPhones returns all phone numbers
func (v *VCard) GetPhones() []Phone <span class="cov4" title="4">{
        return v.phones
}</span>

// GetAddresses returns all addresses
func (v *VCard) GetAddresses() []Address <span class="cov2" title="2">{
        return v.addresses
}</span>

// GetOrganization returns the organization information
func (v *VCard) GetOrganization() Organization <span class="cov3" title="3">{
        return v.organization
}</span>

// GetURLs returns all URLs
func (v *VCard) GetURLs() []URL <span class="cov2" title="2">{
        return v.urls
}</span>

// GetPhoto returns the photo data/URL
func (v *VCard) GetPhoto() string <span class="cov3" title="3">{
        return v.photo
}</span>

// GetNote returns the note text
func (v *VCard) GetNote() string <span class="cov3" title="3">{
        return v.note
}</span>

// GetBirthday returns the birthday if set
func (v *VCard) GetBirthday() *time.Time <span class="cov3" title="3">{
        return v.birthday
}</span>

// GetAnniversary returns the anniversary if set
func (v *VCard) GetAnniversary() *time.Time <span class="cov3" title="3">{
        return v.anniversary
}</span>

// GetCustomProperties returns all custom properties
func (v *VCard) GetCustomProperties() map[string]string <span class="cov4" title="4">{
        props := make(map[string]string)
        for k, v := range v.customProps </span><span class="cov5" title="7">{
                props[k] = v
        }</span>
        <span class="cov4" title="4">return props</span>
}

// GetCustomProperty returns a specific custom property value
func (v *VCard) GetCustomProperty(name string) string <span class="cov4" title="5">{
        return v.customProps[name]
}</span>
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
